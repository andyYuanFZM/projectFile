# Chain33中实现DPos共识的方案

## 1.1 需求背景
Chain33区块链支持可插拔的插件化设计，目前已经支持POS， tendermint, raft， pbft等共识。实现DPos共识主要是丰富chain33的插件库，给使用chain33的用户更多的选择。

## 1.2 方案选型
调查了市面上使用DPOS共识的区块链，包括EOS, asch, Lisk, VNT, NAS等。 总体上都是遵循DPOS共识协议（最早由比特股社区提出），
区别在于实现的上一些细节，有些是代理节点依次轮流出块，有些是代理节点连续生产几个块后再切换成另一个代理节点; 有些在DPOS的基础上增加了PBFT的机制作为性能和安全性改进; 有些是代理节点的数目不同等等。

综合性能和成熟度方面的考量，本方案使用DPOS的共识协议，来实现chain33的共识插件。

### 1.2.1 选型原因分析 

DPOS共识的逻辑： 
1. 由生产者列表和时间偏移共同决定当前由谁来打包区块。  -- 解决谁来打包区块
2. 按照固定的时间间隔来打包区块。   -- 解决何时打包区块
3. 通过区块中附带的签名和生产者的公钥验证区块的合法性。  -- 解决如何验证区块的合法性

## 1.3 实现要点

### 一期计划：

### 1.3.1 共识逻辑实现

DPOS部分：
1. 每隔1秒（可配置）出一个块，生产节点随机出块，每一个生产节点出6个块后再切换至另一个生产节点。
2. 当某个生产节点在1秒内没有成功出块，则跳过该块。

### 1.3.2. P2P传输实现
1.  可以参考tendermint共识的实现方式
2.  或者可以采用go的libp2p来实现

### 二期计划
增加节点投票能力，包括实现投票合约，投票系统（投票客户端）等
